<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="UTF-8" />
		<meta name="viewport" content="width=device-width, initial-scale=1.0" />
		<title>Document</title>
	</head>
	<body>
		<div class="watched"></div>
		<button>button</button>
		<script src="../index.js"></script>
		<script>
			const watched = document.querySelector(".watched");
			const btn = document.querySelector("button");
			const obj = reactive({
				count: 1,
				data: [],
			});

			btn.addEventListener("click", () => {
				obj.count++;
        console.log(obj.count);
			});

			effect(() => {
				for (let i = 0; i < obj.data.length; i++) {
					const itemBox = document.createElement("div");
					const idBox = document.createElement("span");
					const titleBox = document.createElement("span");
					itemBox.append(idBox);
					itemBox.append(titleBox);
					idBox.textContent = obj.data[i].id + "---";
					titleBox.textContent = obj.data[i].title;
					watched.appendChild(itemBox);
				}
			});

			wacth(
				() => obj.count,
				async (newVal, oldVal, onInvalidate) => {
					let expired = false;

					onInvalidate(() => {
						expired = true;
					});

					const response = await fetch(
						"https://jsonplaceholder.typicode.com/posts"
					);
					if (!expired) {
						obj.data = await response.json();
					}
				},
				{}
			);
		</script>
	</body>
</html>
